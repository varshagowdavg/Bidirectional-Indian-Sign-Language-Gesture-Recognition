<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SignSetu - Sign to Voice</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        .tabs {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .tab-btn {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-color);
            padding: 0.5rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .tab-content {
            display: none;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            flex-direction: column;
            align-items: center;
        }

        .tab-content.active {
            display: flex;
        }

        .video-container {
            width: 100%;
            max-width: 640px;
            border-radius: 1rem;
            overflow: hidden;
            margin-bottom: 1rem;
            border: 1px solid var(--glass-border);
        }

        .video-container img {
            width: 100%;
            display: block;
        }

        .live-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .prediction-display {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 1rem 0;
            min-height: 3rem;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="logo">SignSetu</div>
            <nav>
                <a href="{{ url_for('index') }}">Home</a>
                <a href="{{ url_for('audio_to_isl') }}">Audio to ISL</a>
                <a href="{{ url_for('text_to_isl') }}">Text to ISL</a>
                <a href="{{ url_for('text_to_voice') }}">Text to Voice</a>
                <a href="{{ url_for('sign_to_voice') }}" class="active">Sign to Voice</a>
                <a href="{{ url_for('about') }}">About</a>
            </nav>
        </header>

        <main>
            <div class="hero">
                <h1>Sign to <span class="highlight">Voice</span></h1>
                <p>Convert sign language gestures (Live Camera or Image) into speech.</p>
            </div>

            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('live')">Live Camera</button>
                <button class="tab-btn" onclick="switchTab('upload')">Upload Image</button>
            </div>

            <!-- Live Camera Section -->
            <div id="live-tab" class="tab-content active">
                <div class="video-container">
                    <img src="{{ url_for('video_feed') }}" alt="Live Camera Feed">
                </div>
                <div class="prediction-display" id="livePrediction">Waiting for sign...</div>
                <div class="live-controls">
                    <button id="speakBtn" class="btn primary">Speak Sign</button>
                </div>
                <audio id="liveAudioPlayer" style="display:none;"></audio>
            </div>

            <!-- Upload Image Section -->
            <div id="upload-tab" class="tab-content">
                <form action="/sign_image_to_voice" method="post" enctype="multipart/form-data" class="upload-form">
                    <div class="file-input-wrapper">
                        <input type="file" name="sign_image" id="sign_image" accept="image/*" required>
                        <label for="sign_image" class="btn secondary">Choose Image</label>
                    </div>
                    <button type="submit" class="btn primary">Convert</button>
                </form>

                {% if error %}
                <div class="error-message">
                    <p>{{ error }}</p>
                </div>
                {% endif %}

                {% if predicted_text %}
                <div class="result-section">
                    <h2>Detected Sign:</h2>
                    <p class="recognized-text">{{ predicted_text }}</p>

                    {% if uploaded_image_url %}
                    <div class="image-container">
                        <img src="{{ url_for('static', filename=uploaded_image_url) }}" alt="Uploaded Sign">
                    </div>
                    {% endif %}

                    {% if audio_url %}
                    <h2>Generated Voice:</h2>
                    <div class="audio-container" style="margin-top: 1rem;">
                        <audio controls autoplay>
                            <source src="{{ url_for('static', filename=audio_url) }}" type="audio/mpeg">
                            Your browser does not support the audio element.
                        </audio>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </main>

        <footer>
            <p>&copy; 2024 SignSetu Project. All rights reserved.</p>
        </footer>
    </div>

    <script>
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));

            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // Live Camera Speak Functionality
        const speakBtn = document.getElementById('speakBtn');
        const livePrediction = document.getElementById('livePrediction');
        const liveAudioPlayer = document.getElementById('liveAudioPlayer');

        speakBtn.addEventListener('click', async () => {
            try {
                const response = await fetch('/speak_current_sign', { method: 'POST' });
                const data = await response.json();

                if (data.error) {
                    alert(data.error);
                } else {
                    livePrediction.textContent = data.text;
                    liveAudioPlayer.src = "{{ url_for('static', filename='') }}" + data.audio_url;
                    liveAudioPlayer.style.display = 'block';
                    liveAudioPlayer.play();
                }
            } catch (err) {
                console.error("Error speaking sign:", err);
            }
        });

        // File input label update
        const fileInput = document.getElementById('sign_image');
        if (fileInput) {
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    document.querySelector('label[for="sign_image"]').textContent = e.target.files[0].name;
                }
            });
        }
    </script>
</body>

</html>